<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Wl_data_offer (wayland.Wayland__Wayland_client.Wl_data_offer)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">wayland</a> &#x00BB; <a href="../index.html">Wayland__Wayland_client</a> &#x00BB; Wl_data_offer</nav><h1>Module <code>Wayland__Wayland_client.Wl_data_offer</code></h1><p>Offer to transfer data.</p><p>A wl_data_offer represents a piece of data offered for transfer by another client (the source client). It is used by the copy-and-paste and drag-and-drop mechanisms. The offer describes the different mime types that the data can be converted to and provides the mechanism for transferring the data directly from the source client.</p><nav class="toc"><ul><li><a href="#version-1,-2">Version 1, 2</a></li><li><a href="#version-3">Version 3</a></li><li><a href="#handlers">Handlers</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'v t</span></code><code> = <span><span>(<span>[ `Wl_data_offer ]</span>, <span class="type-var">'v</span>, <span>[ `Client ]</span>)</span> <a href="../../Wayland/Proxy/index.html#type-t">Wayland.Proxy.t</a></span></code></dt></dl><div class="spec module" id="module-Error"><a href="#module-Error" class="anchor"></a><code><span class="keyword">module</span> Error = <a href="../../Wayland/Wayland_proto/Wl_data_offer/index.html#module-Error">Wayland.Wayland_proto.Wl_data_offer.Error</a></code></div><section><header><h3 id="version-1,-2"><a href="#version-1,-2" class="anchor"></a>Version 1, 2</h3></header><dl><dt class="spec value" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span class="keyword">val</span> destroy : <span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Destroy data offer.</p><p>Destroy the data offer.</p></dd></dl><dl><dt class="spec value" id="val-receive"><a href="#val-receive" class="anchor"></a><code><span class="keyword">val</span> receive : <span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>mime_type:string</span> <span>&#45;&gt;</span> <span>fd:Unix.file_descr</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Request that the data is transferred.</p><p>To transfer the offered data, the client issues this request and indicates the mime type it wants to receive. The transfer happens through the passed file descriptor (typically created with the pipe system call). The source client writes the data in the mime type representation requested and then closes the file descriptor.</p><p>The receiving client reads from the read end of the pipe until EOF and then closes its end, at which point the transfer is complete.</p><p>This request may happen multiple times for different mime types, both before and after wl_data_device.drop. Drag-and-drop destination clients may preemptively fetch data or examine it more closely to determine acceptance.</p></dd></dl><dl><dt class="spec value" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span class="keyword">val</span> accept : <span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>serial:int32</span> <span>&#45;&gt;</span> <span>mime_type:<span>string option</span></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Accept one of the offered mime types.</p><p>Indicate that the client can accept the given mime type, or NULL for not accepted.</p><p>For objects of version 2 or older, this request is used by the client to give feedback whether the client can receive the given mime type, or NULL if none is accepted; the feedback does not determine whether the drag-and-drop operation succeeds or not.</p><p>For objects of version 3 or newer, this request determines the final result of the drag-and-drop operation. If the end result is that no mime types were accepted, the drag-and-drop operation will be cancelled and the corresponding drag source will receive wl_data_source.cancelled. Clients may still use this event in conjunction with wl_data_source.action for feedback.</p></dd></dl></section><section><header><h3 id="version-3"><a href="#version-3" class="anchor"></a>Version 3</h3></header><dl><dt class="spec value" id="val-set_actions"><a href="#val-set_actions" class="anchor"></a><code><span class="keyword">val</span> set_actions : <span><span>[&lt; `V3 ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>dnd_actions:int32</span> <span>&#45;&gt;</span> <span>preferred_action:int32</span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Set the available/preferred drag-and-drop actions.</p><p>Sets the actions that the destination side client supports for this operation. This request may trigger the emission of wl_data_source.action and wl_data_offer.action events if the compositor needs to change the selected action.</p><p>This request can be called multiple times throughout the drag-and-drop operation, typically in response to wl_data_device.enter or wl_data_device.motion events.</p><p>This request determines the final result of the drag-and-drop operation. If the end result is that no action is accepted, the drag source will receive wl_data_source.cancelled.</p><p>The dnd_actions argument must contain only values expressed in the wl_data_device_manager.dnd_actions enum, and the preferred_action argument must only contain one of those values set, otherwise it will result in a protocol error.</p><p>While managing an &quot;ask&quot; action, the destination drag-and-drop client may perform further wl_data_offer.receive requests, and is expected to perform one last wl_data_offer.set_actions request with a preferred action other than &quot;ask&quot; (and optionally wl_data_offer.accept) before requesting wl_data_offer.finish, in order to convey the action selected by the user. If the preferred action is not in the wl_data_offer.source_actions mask, an error will be raised.</p><p>If the &quot;ask&quot; action is dismissed (e.g. user cancellation), the client is expected to perform wl_data_offer.destroy right away.</p><p>This request can only be made on drag-and-drop offers, a protocol error will be raised otherwise.</p></dd></dl><dl><dt class="spec value" id="val-finish"><a href="#val-finish" class="anchor"></a><code><span class="keyword">val</span> finish : <span><span>[&lt; `V3 ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>The offer will no longer be used.</p><p>Notifies the compositor that the drag destination successfully finished the drag-and-drop operation.</p><p>Upon receiving this request, the compositor will emit wl_data_source.dnd_finished on the drag source client.</p><p>It is a client error to perform other requests than wl_data_offer.destroy after this one. It is also an error to perform this request after a NULL mime type has been set in wl_data_offer.accept or no action was received through wl_data_offer.action.</p><p>If wl_data_offer.finish request is received for a non drag and drop operation, the invalid_finish protocol error is raised.</p></dd></dl></section><section><header><h3 id="handlers"><a href="#handlers" class="anchor"></a>Handlers</h3><p>Note: Servers will always want to use <code>v1</code>.</p></header><dl><dt class="spec class" id="class-v1"><a href="#class-v1" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v1/index.html">v1</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 1.</p></dd></dl><dl><dt class="spec class" id="class-v2"><a href="#class-v2" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v2/index.html">v2</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 2.</p></dd></dl><dl><dt class="spec class" id="class-v3"><a href="#class-v3" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v3/index.html">v3</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 3.</p></dd></dl></section></div></body></html>