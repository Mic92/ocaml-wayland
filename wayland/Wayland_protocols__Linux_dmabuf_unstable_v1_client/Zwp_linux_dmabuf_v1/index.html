<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Zwp_linux_dmabuf_v1 (wayland.Wayland_protocols__Linux_dmabuf_unstable_v1_client.Zwp_linux_dmabuf_v1)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">wayland</a> &#x00BB; <a href="../index.html">Wayland_protocols__Linux_dmabuf_unstable_v1_client</a> &#x00BB; Zwp_linux_dmabuf_v1</nav><h1>Module <code>Wayland_protocols__Linux_dmabuf_unstable_v1_client.Zwp_linux_dmabuf_v1</code></h1><p>Factory for creating dmabuf-based wl_buffers.</p><p>Following the interfaces from: https://www.khronos.org/registry/egl/extensions/EXT/EGL_EXT_image_dma_buf_import.txt https://www.khronos.org/registry/EGL/extensions/EXT/EGL_EXT_image_dma_buf_import_modifiers.txt and the Linux DRM sub-system's AddFb2 ioctl.</p><p>This interface offers ways to create generic dmabuf-based wl_buffers. Immediately after a client binds to this interface, the set of supported formats and format modifiers is sent with 'format' and 'modifier' events.</p><p>The following are required from clients:</p><ul><li>Clients must ensure that either all data in the dma-buf is coherent for all subsequent read access or that coherency is correctly handled by the underlying kernel-side dma-buf implementation.</li></ul><ul><li>Don't make any more attachments after sending the buffer to the compositor. Making more attachments later increases the risk of the compositor not being able to use (re-import) an existing dmabuf-based wl_buffer.</li></ul><p>The underlying graphics stack must ensure the following:</p><ul><li>The dmabuf file descriptors relayed to the server will stay valid for the whole lifetime of the wl_buffer. This means the server may at any time use those fds to import the dmabuf into any kernel sub-system that might accept it.</li></ul><p>However, when the underlying graphics stack fails to deliver the promise, because of e.g. a device hot-unplug which raises internal errors, after the wl_buffer has been successfully created the compositor must not raise protocol errors to the client when dmabuf import later fails.</p><p>To create a wl_buffer from one or more dmabufs, a client creates a zwp_linux_dmabuf_params_v1 object with a zwp_linux_dmabuf_v1.create_params request. All planes required by the intended format are added with the 'add' request. Finally, a 'create' or 'create_immed' request is issued, which has the following outcome depending on the import success.</p><p>The 'create' request,</p><ul><li>on success, triggers a 'created' event which provides the final wl_buffer to the client.</li><li>on failure, triggers a 'failed' event to convey that the server cannot use the dmabufs received from the client.</li></ul><p>For the 'create_immed' request,</p><ul><li>on success, the server immediately imports the added dmabufs to create a wl_buffer. No event is sent from the server in this case.</li><li>on failure, the server can choose to either:</li><li>terminate the client by raising a fatal error.</li><li>mark the wl_buffer as failed, and send a 'failed' event to the client. If the client uses a failed wl_buffer as an argument to any request, the behaviour is compositor implementation-defined.</li></ul><p>Warning! The protocol described in this file is experimental and backward incompatible changes may be made. Backward compatible changes may be added together with the corresponding interface version bump. Backward incompatible changes are done by bumping the version number in the protocol and interface names and resetting the interface version. Once the protocol is to be declared stable, the 'z' prefix and the version number in the protocol and interface names are removed and the interface version number is reset.</p><nav class="toc"><ul><li><a href="#version-1,-2">Version 1, 2</a></li><li><a href="#version-3">Version 3</a></li><li><a href="#handlers">Handlers</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'v t</span></code><code> = <span><span>(<span>[ `Zwp_linux_dmabuf_v1 ]</span>, <span class="type-var">'v</span>, <span>[ `Client ]</span>)</span> <a href="../$Open__4_95/index.html#module-$Proxy">$Proxy</a>.t</span></code></dt></dl><section><header><h3 id="version-1,-2"><a href="#version-1,-2" class="anchor"></a>Version 1, 2</h3></header><dl><dt class="spec value" id="val-create_params"><a href="#val-create_params" class="anchor"></a><code><span class="keyword">val</span> create_params : <span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> ]</span> <span class="keyword">as</span> 'a <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>[<span>[ `Zwp_linux_buffer_params_v1 ]</span>, <span class="type-var">'a</span>, <span>[ `Client ]</span>]</span> <a href="../$Open__4_95/index.html#module-$Proxy">$Proxy</a>.Handler.t</span> <span>&#45;&gt;</span> <span><span>(<span>[ `Zwp_linux_buffer_params_v1 ]</span>, <span class="type-var">'a</span>, <span>[ `Client ]</span>)</span> <a href="../$Open__4_95/index.html#module-$Proxy">$Proxy</a>.t</span></code></dt><dd><p>Create a temporary object for buffer parameters.</p><p>This temporary object is used to collect multiple dmabuf handles into a single batch to create a wl_buffer. It can only be used once and should be destroyed after a 'created' or 'failed' event has been received.</p></dd></dl><dl><dt class="spec value" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span class="keyword">val</span> destroy : <span><span>[&lt; `V1 <span>| `V2</span> <span>| `V3</span> ]</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> unit</code></dt><dd><p>Unbind the factory.</p><p>Objects created through this interface, especially wl_buffers, will remain valid.</p></dd></dl></section><section><header><h3 id="version-3"><a href="#version-3" class="anchor"></a>Version 3</h3></header></section><section><header><h3 id="handlers"><a href="#handlers" class="anchor"></a>Handlers</h3><p>Note: Servers will always want to use <code>v1</code>.</p></header><dl><dt class="spec class" id="class-v1"><a href="#class-v1" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v1/index.html">v1</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 1.</p></dd></dl><dl><dt class="spec class" id="class-v2"><a href="#class-v2" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v2/index.html">v2</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 2.</p></dd></dl><dl><dt class="spec class" id="class-v3"><a href="#class-v3" class="anchor"></a><code><span class="keyword">class</span> <span class="keyword">virtual</span> +'a <a href="class-v3/index.html">v3</a> : <span class="keyword">object</span> ... <span class="keyword">end</span></code></dt><dd><p>Handler for a proxy with version &gt;= 3.</p></dd></dl></section></div></body></html>